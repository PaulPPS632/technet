<p class="text-2xl text-center font-extrabold text-gray-800 dark:text-white">Inventario Productos</p>

<br>

<button 
class="w-full items-center rounded-lg bg-blue-700 px-5 py-2.5 text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4  focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
  type="submit" (click)="abrirModal(modalContent)" >Crear Nuevo Producto</button>

<br>
<br>

<div class="mb-6">
  <label for="buscar" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Buscar Producto</label>
  <input type="text" id="buscar" name="buscar" (input)="buscarProducto($event)" placeholder="Ingrese nombre del producto a buscar..."
  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required />
</div>
  
<ng-template #modalContent let-modal>
  <div class="modal-header d-flex justify-content-center align-items-center">
    <h2 class="modal-title"><b>Añadir Producto</b></h2>
  </div>
  
  <div class="modal-body">
    <app-crear-producto></app-crear-producto>
  </div>
</ng-template>

<ng-template #modalEditar let-modal>
  <div class="modal-header d-flex justify-content-center align-items-center">
    <h2 class="modal-title"><b>Editar Producto</b></h2>
  </div>

  <div class="modal-body">
    <form>
      <div class="mb-6">
        <label for="editNombre" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Nombre Producto</label>
        <input type="text" id="editNombre" name="editNombre" [(ngModel)]="editNombre" placeholder="Ingrese nombre del producto..."
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required />
      </div>

      <div class="mb-6">
        <label for="editPn" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">PN Producto</label>
        <input type="text" id="editPn" name="editPn" [(ngModel)]="editPn" placeholder="Ingrese nombre del PN del producto..."
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required />
      </div>

      <div class="mb-6">
        <label for="editDescripcion" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Descripción</label>
        <textarea id="editDescripcion" name="editDescripcion" [(ngModel)]="editDescripcion" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"></textarea>
      </div>

      <div class="mb-6">
        <label for="editStock" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Stock</label>
        <input type="number" id="editStock" name="editStock" [(ngModel)]="editStock" placeholder="Ingrese stock del producto..."
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required />
      </div>

      <div class="mb-6">
        <label for="editPrecio" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Precio</label>
        <input type="number" id="editPrecio" name="editPrecio" [(ngModel)]="editPrecio" placeholder="Ingrese el precio del producto..."
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required />
      </div>

      <div class="mb-6">
        <label for="editCatMarca" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Id Categoria Marca</label>
        <input type="text" id="editCatMarca" name="editCatMarca" [(ngModel)]="editCategoriaMarca" placeholder="Ingrese la marca del producto..."
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required />
      </div>

      <div class="mb-6">
        <label for="editSubCategoria" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Id Sub Categoria</label>
        <input type="text" id="editSubCategoria" name="editSubCategoria" [(ngModel)]="editSubCategoria" placeholder="Ingrese id categoriamarca del producto..."
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required />
      </div>

      <div class="mb-6">
        <label for="editGarantiaCliente" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Garantia Cliente</label>
        <input type="number" id="editGarantiaCliente" name="editGarantiaCliente" [(ngModel)]="editGarantiaCliente" placeholder="Ingrese la garantía cliente..."
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required />
      </div>

      <div class="mb-6">
        <label for="editGarantiaTotal" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Garantia Total</label>
        <input type="number" id="editGarantiaTotal" name="editGarantiaTotal" [(ngModel)]="editGarantiaTotal" placeholder="Ingrese la garantía total..."
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required />
      </div>

      <div class="mb-6">
        <label for="editArchivo" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Seleccionar Archivo</label>
        <input type="file" id="editArchivo" name="editArchivo" (change)="onFileChange($event)" multiple required class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400">
      </div>

      <button type="button" class="w-full items-center rounded-lg bg-blue-700 px-5 py-2.5 text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" (click)="guardarCambios()">Guardar Cambios</button>
    </form>
  </div>

  <div class="modal-footer">
    <button type="button" 
    class="btn btn-secondary" 
    (click)="modal.dismiss('cancel')">Cancelar</button>
  </div>

</ng-template>

<ng-template #modalPedido let-modal>
  <div class="modal-header d-flex justify-content-center align-items-center">
    <h2 class="modal-title"><b>Realizar Pedido</b></h2>
  </div>
  
  <div class="modal-body">
    <form>
      <div class="mb-6">
        <label for="nombre" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Nombre Producto</label>
        <input type="text" id="nombre" name="nombre" [(ngModel)]="ProductoNombrePedidoSelect" placeholder="Ingrese id categoriamarca del producto..."
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required />
      </div>

      <div class="mb-6">
        <label for="cantidad" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cantidad</label>
        <input type="number" id="cantidad" name="cantidad" [(ngModel)]="ProductoCantidadPedidoSelect"  placeholder="Ingrese la garantía total..."
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required />
      </div>

      <div class="mb-6">
        <label for="nota"class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Nota</label>
        <input type="text" id="nota" name="nota" [(ngModel)]="ProductoNotaPedidoSelect" placeholder="Ingrese id categoriamarca del producto..."
        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required />
      </div>

      <button type="button" 
      class="w-full items-center rounded-lg bg-blue-700 px-5 py-2.5 text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4  focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
      (click)="RegistrarPedido()">Realizar Pedido</button>
    </form>
  </div>

  <div class="modal-footer">
    <button type="button" 
    class="btn btn-secondary" 
    (click)="modal.dismiss('cancel')">Cancelar</button>
  </div>

</ng-template>

<!-- TABLA CRUD -->
  <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
    <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
      <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
        <tr>
          <!--<th scope="col">ID (Serie Producto)</th>-->
          <th scope="col" class="px-6 py-3">Nombre Producto</th>
          <th scope="col" class="px-6 py-3">PN</th>
          <th scope="col" class="px-6 py-3">Descripcion</th>
          <th scope="col" class="px-6 py-3">Precio</th>
          <th scope="col" class="px-6 py-3">Stock</th>
          <th scope="col" class="px-6 py-3">Marca</th>
          <th scope="col" class="px-6 py-3">Categoria Marca</th>
          <th scope="col" class="px-6 py-3">G.Cliente</th>
          <th scope="col" class="px-6 py-3">G.Total</th>
          <th scope="col" class="px-6 py-3">Imagen</th>
          <th scope="col" class="px-6 py-3">Acciones</th>
        </tr>
      </thead>

      <tbody>
        @for (p of productos; track p.id) {
          <tr *ngFor="let p of filtroProducto" class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
            <!--<th scope="row">{{p.id}}</th>-->
            <td class="px-6 py-4">{{p.nombre}}</td>
            <td class="px-6 py-4">{{p.pn}}</td>
            <td class="px-6 py-4">{{p.descripcion}}</td>
            <td class="px-6 py-4">{{p.precio}}</td>
            <td class="px-6 py-4">{{p.stock}}</td>
            <td class="px-6 py-4">{{p.marca}}</td>
            <td class="px-6 py-4">{{p.categoriamarca}}</td>
            <td class="px-6 py-4">{{p.garantia_cliente}}</td>
            <td class="px-6 py-4">{{p.garantia_total}}</td>
            <td class="px-6 py-4">
                <img [src]="url + '/images/' + p.imageurl[0]" >
            </td>

            <td class="px-6 py-4">
              <button type="button" 
              class="focus:outline-none text-white bg-yellow-400 hover:bg-yellow-500 focus:ring-4 focus:ring-yellow-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:focus:ring-yellow-900"
              (click)="editarProducto(modalEditar, p.id)">Editar</button>
              <button type="button" 
              class="focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900"
              (click)="eliminarProducto(p.id)">Eliminar</button>
                @if (p.stock<20) {
                  <button type="button" 
                  class="focus:outline-none text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800"
                  (click)="abrirModalPedido(modalPedido, p.id ,p.nombre)">Stockear</button>
                }
            </td>
          
          </tr>
        }
          
      </tbody>

    </table>
  </div>